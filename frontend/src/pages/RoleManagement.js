import React,{useState} from 'react';import{Container,Paper,Typography,Box,Button,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,Chip,Dialog,DialogTitle,DialogContent,DialogActions,TextField,FormControl,InputLabel,Select,MenuItem,IconButton}from '@mui/material';import{Add,Edit,Delete,AdminPanelSettings,Security}from '@mui/icons-material';const RM=()=>{const[roles,setRoles]=useState([{id:1,name:'SYSTEM_ADMIN',desc:'Full access',sys:true,users:1,perms:['create','read','update','delete']},{id:2,name:'Patrimoine',desc:'Property service',sys:false,users:3,perms:['create','read','update']},{id:3,name:'DCRTCT',desc:'Direction validation',sys:false,users:2,perms:['read','update','approve']},{id:4,name:'Agent',desc:'Reception',sys:false,users:4,perms:['create','read']},{id:5,name:'Validator',desc:'Validator',sys:false,users:2,perms:['read','validate']}]);const[dlg,setDlg]=useState(false);const[edit,setEdit]=useState(null);const[nw,setNw]=useState({name:'',desc:'',perms:[]});const perms=['create','read','update','delete','approve','validate'];const add=()=>{if(nw.name){setRoles([...roles,{id:Math.max(...roles.map(r=>r.id),0)+1,name:nw.name,desc:nw.desc,sys:false,users:0,perms:nw.perms}]);setNw({name:'',desc:'',perms:[]});setDlg(false);}}; const save=()=>{if(edit){setRoles(roles.map(r=>r.id===edit.id?edit:r));setEdit(null);setDlg(false);}}; return<Container maxWidth="lg" sx={{py:{xs:2,md:4}}}><Box sx={{mb:4,display:'flex',justifyContent:'space-between',alignItems:'center'}}><Typography variant="h4" sx={{color:'#1976d2',fontWeight:'bold'}}>Roles</Typography><Button variant="contained" startIcon={<Add/>} onClick={()=>{setEdit(null);setDlg(true)}} sx={{backgroundColor:'#1976d2'}}>Add</Button></Box><TableContainer component={Paper}><Table><TableHead><TableRow sx={{backgroundColor:'#1976d2'}}><TableCell sx={{color:'#fff'}}>Name</TableCell><TableCell sx={{color:'#fff'}}>Desc</TableCell><TableCell sx={{color:'#fff'}}>Type</TableCell><TableCell sx={{color:'#fff'}}>Users</TableCell><TableCell sx={{color:'#fff'}}>Perms</TableCell><TableCell sx={{color:'#fff'}}>Actions</TableCell></TableRow></TableHead><TableBody>{roles.map(r=><TableRow key={r.id}><TableCell sx={{fontWeight:'bold'}}>{r.name}</TableCell><TableCell>{r.desc}</TableCell><TableCell><Chip icon={r.sys?<AdminPanelSettings/>:<Security/>} label={r.sys?'Sys':'Custom'} color={r.sys?'primary':'default'}/></TableCell><TableCell>{r.users}</TableCell><TableCell><Box sx={{display:'flex',gap:0.5,flexWrap:'wrap'}}>{r.perms.map(p=><Chip key={p} label={p} size="small"/>)}</Box></TableCell><TableCell><IconButton size="small" onClick={()=>{setEdit(r);setDlg(true)}}><Edit fontSize="small"/></IconButton>{!r.sys&&<IconButton size="small" color="error" onClick={()=>setRoles(roles.filter(x=>x.id!==r.id))}><Delete fontSize="small"/></IconButton>}</TableCell></TableRow>)}</TableBody></Table></TableContainer><Dialog open={dlg} onClose={()=>{setDlg(false);setEdit(null)}} maxWidth="sm" fullWidth><DialogTitle>{edit?'Edit':'Add'}</DialogTitle><DialogContent sx={{pt:2}}><TextField fullWidth label="Name" value={edit?edit.name:nw.name} onChange={e=>edit?setEdit({...edit,name:e.target.value}):setNw({...nw,name:e.target.value})} margin="normal"/><TextField fullWidth label="Description" value={edit?edit.desc:nw.desc} onChange={e=>edit?setEdit({...edit,desc:e.target.value}):setNw({...nw,desc:e.target.value})} margin="normal"/><Typography sx={{mt:2,mb:1,fontWeight:'bold'}}>Permissions</Typography><Box sx={{display:'flex',flexWrap:'wrap',gap:1}}>{perms.map(p=><Button key={p} size="small" variant={(edit?edit.perms:nw.perms).includes(p)?'contained':'outlined'} onClick={()=>edit?setEdit({...edit,perms:edit.perms.includes(p)?edit.perms.filter(x=>x!==p):[...edit.perms,p]}):setNw({...nw,perms:nw.perms.includes(p)?nw.perms.filter(x=>x!==p):[...nw.perms,p]})}>{p}</Button>)}</Box></DialogContent><DialogActions><Button onClick={()=>{setDlg(false);setEdit(null)}}>Cancel</Button><Button onClick={edit?save:add} variant="contained" sx={{backgroundColor:'#1976d2'}}>Save</Button></DialogActions></Dialog></Container>;};export default RM;
